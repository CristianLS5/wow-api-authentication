<!DOCTYPE html>
<html>
<head>
    <title>Battle.net Auth Demo</title>
    <link rel="stylesheet" href="styles/common.css">
</head>
<body>
    <h1>Battle.net Authentication Demo</h1>
    <div class="instructions">
        <p>Click the button below to start the authentication process:</p>
    </div>
    <button onclick="startAuth()" id="loginButton">Login with Battle.net</button>

    <script>
        window.onload = async function() {
            try {
                const response = await fetch('https://wow-api-authentication-server.vercel.app/auth/check', {
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                const { isAuthenticated } = await response.json();
                
                if (isAuthenticated) {
                    window.location.replace('/redirect-test.html');
                }
            } catch (error) {
                console.error('Auth check failed:', error);
            }
        }

        function startAuth() {
            fetch('https://wow-api-authentication-server.vercel.app/auth/bnet', {
                credentials: 'include',
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (response.redirected) {
                    window.location.href = response.url;
                }
            })
            .catch(error => {
                console.error('Auth initialization failed:', error);
            });
        }
    </script>
</body>
</html> 